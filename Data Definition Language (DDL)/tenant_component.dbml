//////////////////////////////////////////////////
// CORE PERSON & TENANCY STRUCTURE
//////////////////////////////////////////////////

Table tenant_person {
  tenant_id integer [pk, increment]
  full_name varchar(255) [not null]
  date_of_birth date
  phone_number varchar(50)
  email varchar(255)
}

Table tenancy {
  tenancy_id integer [pk, increment]
  tenant_id integer [not null, ref: > tenant_person.tenant_id]
  address_id integer [not null]
  start_date date [not null]
  end_date date
  tenancy_type varchar(100) [not null]
  tenancy_status varchar(100) [not null]
 }

Table household_member_person {
  household_member_id integer [pk, increment]
  tenant_id integer [not null, ref: > tenant_person.tenant_id]
  tenancy_id integer [not null, ref: > tenancy.tenancy_id]
  full_name varchar(255) [not null]
  date_of_birth date
  relationship_to_tenant varchar(100)
  is_contract_holder boolean [default: false]
}

//////////////////////////////////////////////////
// ALERT STRUCTURE
//////////////////////////////////////////////////

Table alert_category {
  alert_category_id integer [pk, increment]
  name varchar(100) [not null, unique]
  description text
}

Table person_alert_code {
  person_alert_code_id integer [pk, increment]
  code varchar(50) [not null, unique]
  name varchar(255) [not null]
  description text
  alert_category_id integer [ref: > alert_category.alert_category_id]
}

//////////////////////////////////////////////////
// ALERT ASSIGNMENTS (UNIFIED)
//////////////////////////////////////////////////

Table person_alert_assignment {
  person_alert_assignment_id integer [pk, increment]
  tenant_id integer [ref: > tenant_person.tenant_id] // nullable, only one of these is filled
  household_member_id integer [ref: > household_member_person.household_member_id] // nullable
  person_alert_code_id integer [not null, ref: > person_alert_code.person_alert_code_id]
  severity_level varchar(50)
  source_type varchar(100)
  start_date date [not null, default: `current_date`]
  end_date date
  is_active boolean [default: true]

  indexes {
    (tenant_id, person_alert_code_id, start_date) [unique]
    (household_member_id, person_alert_code_id, start_date) [unique]
  }
  //checks {
  //  "tenant_id IS NOT NULL OR household_member_id IS NOT NULL"
  // "NOT (tenant_id IS NOT NULL AND household_member_id IS NOT NULL)"
  //}
}

//////////////////////////////////////////////////
// ALERT HISTORY / AUDIT TRAIL
//////////////////////////////////////////////////

Table person_alert_history {
  alert_history_id integer [pk, increment]
  person_alert_assignment_id integer [not null, ref: > person_alert_assignment.person_alert_assignment_id]
  old_severity_level varchar(50)
  new_severity_level varchar(50)
  old_end_date date
  new_end_date date
  old_is_active boolean
  new_is_active boolean
  change_reason text
  changed_by int // links to a user_id in an external person table
  changed_at timestamp [default: `current_timestamp`]
}
